# render.yaml â€” Blueprint for NoellaButi/code-banking-app
services:
  # --- Web app (Flask + Gunicorn) ---
  - type: web
    name: banklite-web
    env: python
    plan: free
    branch: main
    autoDeploy: true

    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: gunicorn app.wsgi:app

    # Optional: if you didn't add runtime.txt
    # pythonVersion: 3.11.9

    # If you add a simple /ping route later, you can enable:
    # healthCheckPath: /ping

    envVars:
      # Generate a strong secret in Render
      - key: SECRET_KEY
        generateValue: true

      # Flask needs this to find your app for migrations/CLI
      - key: FLASK_APP
        value: app.wsgi:app

      # Prefer Postgres in production
      - key: DATABASE_URL
        fromDatabase:
          name: banklite-db
          property: connectionString

      # SQLAlchemy will read this (keep it equal to DATABASE_URL)
      - key: SQLALCHEMY_DATABASE_URI
        fromDatabase:
          name: banklite-db
          property: connectionString

    # Run migrations automatically after each deploy
    postDeployCommand: flask db upgrade

  # --- Managed Postgres database ---
  - type: postgresql
    name: banklite-db
    plan: free
    # If you need to allow external IPs to connect, add:
    # ipAllowList: []
